<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gamelle (gamelle.Gamelle)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">gamelle</a> &#x00BB; Gamelle</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Gamelle</span></code></h1><p>Gamelle is a tiny 2D game engine. It provides:</p><ul><li>Hot code reload on every file change for a quick feedback loop</li><li>Export to a single HTML file to share your game online</li><li>Automatic assets loading for images, sounds and fonts: see <a href="#Assets" title="Assets">Assets</a></li><li>Immediate mode GUI to quickly put together menus and widgets: see <a href="Ui/index.html"><code>Ui</code></a></li><li>Collisions detection and rigid physics: see <a href="Physics/index.html"><code>Physics</code></a></li></ul></header><nav class="odoc-toc"><ul><li><a href="#getting-started">Getting started</a></li><li><a href="#main-loop">Main loop</a></li><li><a href="#maths">Maths</a><ul><li><a href="#linear-algebra">Linear Algebra</a></li><li><a href="#geometry">Geometry</a></li></ul></li><li><a href="#Assets">Assets</a><ul><li><a href="#images">Images</a></li><li><a href="#text">Text</a></li><li><a href="#audio">Audio</a></li></ul></li><li><a href="#player-inputs">Player inputs</a></li><li><a href="#camera">Camera</a></li><li><a href="#animations">Animations</a></li></ul></nav><div class="odoc-content"><h2 id="getting-started"><a href="#getting-started" class="anchor"></a>Getting started</h2><p>You can create a new game project with:</p><pre class="language-shell"><code>$ gamelle init mygame
$ cd mygame
$ make</code></pre><p>The <code>make</code> command starts the game in development mode: Editing <code>src/mygame.ml</code> will automatically reload your game on every change. Game assets added to the folder <code>assets/</code> are automatically available through the dynamic <code>Assets</code> module.</p><p>To export your game as a single HTML file, compiled with <code>js_of_ocaml</code> and including all game assets:</p><pre class="language-shell"><code>$ make html</code></pre><h2 id="main-loop"><a href="#main-loop" class="anchor"></a>Main loop</h2><div class="odoc-spec"><div class="spec type anchored" id="type-io"><a href="#type-io" class="anchor"></a><code><span><span class="keyword">type</span> io</span></code></div><div class="spec-doc"><p>The type allowing input/output operations. Every side-effecting function requires a named argument <code>~io</code> of this type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><span class="type-var">'state</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="label">io</span>:<a href="#type-io">io</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'state</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'state</span>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>run initial_state fn</code> is the game main loop. The function <code>fn</code> will be called at every frame to react to player inputs and draw the game state on the screen.</p><pre class="language-ocaml"><code>open Gamelle

type state = ...

let initial_state = ...

let () =
  Gamelle.run initial_state @@ fun ~io current_state -&gt;
    let new_state = (* TODO: react to player inputs and update the current state *) in
    (* TODO: draw the new game state *)
    new_state</code></pre></div></div><h2 id="maths"><a href="#maths" class="anchor"></a>Maths</h2><h3 id="linear-algebra"><a href="#linear-algebra" class="anchor"></a>Linear Algebra</h3><p>Gamelle extends the <code>Gg</code> maths library.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Color"><a href="#module-Color" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Color/index.html">Color</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Colors.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Transform"><a href="#module-Transform" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Transform/index.html">Transform</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Rotations, scaling, translations.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Point"><a href="#module-Point" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Point/index.html">Point</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Points: <code>x</code> and <code>y</code> positions in 2D.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Vec"><a href="#module-Vec" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Vec/index.html">Vec</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Vectors: directions in 2D.</p></div></div><h3 id="geometry"><a href="#geometry" class="anchor"></a>Geometry</h3><div class="odoc-spec"><div class="spec module anchored" id="module-Size"><a href="#module-Size" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Size/index.html">Size</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Sizes: <code>width</code> and <code>height</code> dimensions.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Segment"><a href="#module-Segment" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Segment/index.html">Segment</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Segments connecting two <a href="Point/index.html"><code>Point</code></a>s.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Box"><a href="#module-Box" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Box/index.html">Box</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Axis-aligned bounding boxes.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Circle"><a href="#module-Circle" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Circle/index.html">Circle</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Circles.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Polygon"><a href="#module-Polygon" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Polygon/index.html">Polygon</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Polygons.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Shape"><a href="#module-Shape" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Shape/index.html">Shape</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Arbitrary shapes: segments, circles and polygons.</p></div></div><h2 id="Assets"><a href="#Assets" class="anchor"></a>Assets</h2><p>Game assets like images, fonts and sounds which are added to the <code>assets/</code> folder are automatically loaded and available through the dynamic <code>Assets</code> module. For example, a bitmap file <code>assets/foo.png</code> is accessible as <code>Assets.foo : Bitmap.t</code>.</p><h4 id="images"><a href="#images" class="anchor"></a>Images</h4><div class="odoc-spec"><div class="spec module anchored" id="module-Bitmap"><a href="#module-Bitmap" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Bitmap/index.html">Bitmap</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Bitmap images: PNG, JPEG.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-draw"><a href="#val-draw" class="anchor"></a><code><span><span class="keyword">val</span> draw : <span><span class="label">io</span>:<a href="#type-io">io</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">at</span>:<a href="Point/index.html#type-t">Point.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Bitmap/index.html#type-t">Bitmap.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>draw ~io ~at bitmap</code> draws the image <code>bitmap</code> at position <code>at</code> on the screen. Same as <a href="Bitmap/index.html#val-draw"><code>Bitmap.draw</code></a>.</p><p>Example:</p><pre class="language-ocaml"><code>(* draw the assets/player.png bitmap at position x=100, y=200 *)
draw ~io Assets.player ~at:(Point.v 100. 200.) ;</code></pre></div></div><h4 id="text"><a href="#text" class="anchor"></a>Text</h4><div class="odoc-spec"><div class="spec module anchored" id="module-Font"><a href="#module-Font" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Font/index.html">Font</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Typefaces used to render text on screen.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Text"><a href="#module-Text" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Text/index.html">Text</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Text rendering.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-draw_string"><a href="#val-draw_string" class="anchor"></a><code><span><span class="keyword">val</span> draw_string : 
  <span><span class="label">io</span>:<a href="#type-io">io</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<a href="Color/index.html#type-t">Color.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?font</span>:<a href="Font/index.html#type-t">Font.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">at</span>:<a href="Point/index.html#type-t">Point.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>draw_string ~io ~at txt</code> prints the string <code>txt</code> at position <code>at</code> on the screen. Same as <a href="Text/index.html#val-draw"><code>Text.draw</code></a>.</p><ul><li><code>?color</code> is the text color, see <a href="View/index.html#val-color"><code>View.color</code></a></li><li><code>?font</code> is the typeface used to render the text, see <a href="View/index.html#val-font"><code>View.font</code></a></li><li><code>?size</code> is the font size, see <a href="View/index.html#val-font_size"><code>View.font_size</code></a></li></ul><p>Examples:</p><pre class="language-ocaml"><code>draw_string ~io &quot;Hello World&quot; ~at:(Input.mouse_pos ~io) ;
draw_string ~io ~color:Color.red ~at:(Point.v 200. 100.) &quot;Bloody!&quot; ;
draw_string ~io ~at:Point.o &quot;Why so serious?&quot; ~font:Assets.comic_sans ~size:50 ;</code></pre></div></div><h4 id="audio"><a href="#audio" class="anchor"></a>Audio</h4><div class="odoc-spec"><div class="spec module anchored" id="module-Sound"><a href="#module-Sound" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sound/index.html">Sound</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Audio sounds and musics: MP3, OGG.</p></div></div><h2 id="player-inputs"><a href="#player-inputs" class="anchor"></a>Player inputs</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Input"><a href="#module-Input" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Input/index.html">Input</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Player inputs: mouse and keyboard events.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Ui"><a href="#module-Ui" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Ui/index.html">Ui</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Graphical user interface: buttons, checkboxes, text inputs.</p></div></div><h2 id="camera"><a href="#camera" class="anchor"></a>Camera</h2><div class="odoc-spec"><div class="spec module anchored" id="module-View"><a href="#module-View" class="anchor"></a><code><span><span class="keyword">module</span> <a href="View/index.html">View</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Customize the <a href="#type-io"><code>io</code></a> camera, default color and font used.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Window"><a href="#module-Window" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Window/index.html">Window</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Configure the game window.</p></div></div><h2 id="animations"><a href="#animations" class="anchor"></a>Animations</h2><div class="odoc-spec"><div class="spec value anchored" id="val-clock"><a href="#val-clock" class="anchor"></a><code><span><span class="keyword">val</span> clock : <span><span class="label">io</span>:<a href="#type-io">io</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p><code>clock ~io</code> returns the number of elapsed seconds since the game started until the current frame. The clock is defined at the beginning of a frame, calling <code>clock</code> multiple times will always produce the same result.</p><p>Examples:</p><pre class="language-ocaml"><code>(* circle moving around a circle *)
let center = Vec.(100.0 * v (1. +. cos (clock ~io)) (1. +. sin (clock ~io))) in
Circle.fill ~io (Circle.v center 10.0);</code></pre><pre class="language-ocaml"><code>(* show elapsed time since the last click *)
Gamelle.run 0. @@ fun ~io last_click -&gt;
let now = clock ~io in
let last_click = if Input.is_up ~io `click_left then now else last_click in
let elapsed = now -. last_click in
draw_string ~io ~at:Point.o (Printf.sprintf &quot;Time since clicked: %fs&quot; elapsed);
last_click</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dt"><a href="#val-dt" class="anchor"></a><code><span><span class="keyword">val</span> dt : <span><span class="label">io</span>:<a href="#type-io">io</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p><code>dt ~io</code> is the duration of a frame, which is fixed to a 60fps framerate.</p><p>Example:</p><pre class="language-ocaml"><code>Gamelle.run (Point.v 200. 200., Vec.zero) @@ fun ~io (position, velocity) -&gt;
let acceleration = Vec.v 0. 9.81 in
(* gravity *)
let velocity = Vec.(velocity + (dt ~io * acceleration)) in
let position = Vec.(position + (dt ~io * velocity)) in
Circle.draw ~io (Circle.v position 20.0);
(position, velocity)</code></pre></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Ease"><a href="#module-Ease" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Ease/index.html">Ease</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Easing functions, to smooth changes over time.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Anim"><a href="#module-Anim" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Anim/index.html">Anim</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Animations.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Physics"><a href="#module-Physics" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Physics/index.html">Physics</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Rigid physics for <a href="Shape/index.html"><code>Shape</code></a> objects.</p></div></div></div></body></html>
