<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Grpc_test (docs.local.grpc-test.Grpc_test)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../';
let search_urls = ['../../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">docs</a> &#x00BB; <a href="../../index.html">local</a> &#x00BB; <a href="../index.html">grpc-test</a> &#x00BB; Grpc_test</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Grpc_test</span></code></h1><p>A library to help writting tests for gRPC Eio applications.</p><p>This is built with expect-tests in mind. See the keyval application in this repo for a complete example of use.</p></header><nav class="odoc-toc"><ul><li><a href="#testing-environment">Testing environment</a></li><li><a href="#socket-kinds">Socket kinds</a></li><li><a href="#config">Config</a></li><li><a href="#server">Server</a></li></ul></nav><div class="odoc-content"><h2 id="testing-environment"><a href="#testing-environment" class="anchor"></a>Testing environment</h2><p>To use the rest of this API, you need to introduce a new test environment to the scope. This is done via the <a href="#val-run"><code>run</code></a> function. This function will run the given function <code>f</code> with a fresh environment of type <a href="#type-t"><code>t</code></a>, and clean up the environment at the end.</p><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span class="label">env</span>:
    <span>&lt; fs : <span><span class="type-var">_</span> <a href="../../../findlib-1/eio/Eio/Path/index.html#type-t">Eio.Path.t</a></span>
      ; net : <span><span>[&gt; <span><span>[ `Generic <span>| `Unix</span> ]</span> <a href="../../../findlib-1/eio/Eio/Net/index.html#type-ty">Eio.Net.ty</a></span> ]</span> <a href="../../../findlib-1/eio/Eio/Resource/index.html#type-t">Eio.Resource.t</a></span>
      ; process_mgr : <span><span class="type-var">_</span> <a href="../../../findlib-1/eio/Eio/Process/index.html#type-mgr">Eio.Process.mgr</a></span>
      ; stderr : <span><span class="type-var">_</span> <a href="../../../findlib-1/eio/Eio/Flow/index.html#type-sink">Eio.Flow.sink</a></span>
      ; clock : <span><span class="type-var">_</span> <a href="../../../findlib-1/eio/Eio/Time/index.html#type-clock">Eio.Time.clock</a></span>.. &gt;</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">f</span>:<span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../findlib-1/base/Base/index.html#type-unit">Base.unit</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../findlib-1/base/Base/index.html#type-unit">Base.unit</a></span></code></div></div><h2 id="socket-kinds"><a href="#socket-kinds" class="anchor"></a>Socket kinds</h2><p>The tests support both kind of sockaddr, unix sockets and tcp connections, in both cases to connect to a server running on the localhost where the expect tests are running.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Sockaddr_kind"><a href="#module-Sockaddr_kind" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sockaddr_kind/index.html">Sockaddr_kind</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Choosing the kind of sockaddr to use.</p></div></div><h2 id="config"><a href="#config" class="anchor"></a>Config</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Config"><a href="#module-Config" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Config/index.html">Config</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A configuration is required by the library to know how to run your server and client commands.</p></div></div><h2 id="server"><a href="#server" class="anchor"></a>Server</h2><p>The rest of the API is used to run one or several server(s) and connect to it, either by running your app's cli, or in OCaml directly via <a href="Server/index.html#val-with_connection"><code>Server.with_connection</code></a>.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Server"><a href="#module-Server" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Server/index.html">Server</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-With_server"><a href="#module-With_server" class="anchor"></a><code><span><span class="keyword">module</span> <a href="With_server/index.html">With_server</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_server"><a href="#val-with_server" class="anchor"></a><code><span><span class="keyword">val</span> with_server : 
  <span><span class="optlabel">?sockaddr_kind</span>:<a href="Sockaddr_kind/index.html#type-t">Sockaddr_kind.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">config</span>:<a href="Config/index.html#type-t">Config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">f</span>:<span>(<span><a href="With_server/index.html#type-t">With_server.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../findlib-1/base/Base/index.html#type-unit">Base.unit</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../findlib-1/base/Base/index.html#type-unit">Base.unit</a></span></code></div><div class="spec-doc"><p>Takes care of starting a server, running <code>f</code> and stopping the server at the end. <code>sockaddr_kind</code> defaults to <code>Unix_socket</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_client"><a href="#val-run_client" class="anchor"></a><code><span><span class="keyword">val</span> run_client : 
  <span><a href="Server/index.html#type-t">Server.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?offline</span>:<a href="../../../findlib-1/base/Base/index.html#type-bool">Base.bool</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../findlib-1/base/Base/index.html#type-string">Base.string</a> <a href="../../../findlib-1/base/Base/index.html#type-list">Base.list</a></span> <a href="../../../findlib-1/base/Base/index.html#type-list">Base.list</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../findlib-1/base/Base/index.html#type-unit">Base.unit</a></span></code></div><div class="spec-doc"><p><code>run_client server ?offline args</code> runs a client process that will connect to the given server. <code>offline:true</code> should be used for commands that do not connect to the server, and defaults to <code>false</code>. The <code>args</code> are flatten before the actual invocation, the grouping is only useful to make the code more readable (e.g. you can group together a flag with it's required argument, etc.).</p></div></div></div></body></html>
